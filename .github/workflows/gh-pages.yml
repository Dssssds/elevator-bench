name: Build and Deploy GitHub Pages

on:
  push:
    branches:
      - main
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup Bun
        uses: oven-sh/setup-bun@v1
        with:
          bun-version: latest
      
      - name: Build all model folders
        run: |
          # Build each model folder
          for folder in deepseek-v3_2 github-copilot-gpt-5-codex github-copilot-sonnet-4_5 glm-4_6 gpt-oss-120b kimi-k2 kimi-k2-thinking minimax-m2 qwen3-coder; do
            echo "Building $folder..."
            cd "$folder"
            mkdir -p ./dist
            bun build ./index.html --outdir ./dist
            cd ..
          done
      
      - name: Create top-level dist directory
        run: |
          mkdir -p dist
          
          # Copy each model's dist folder
          for folder in deepseek-v3_2 github-copilot-gpt-5-codex github-copilot-sonnet-4_5 glm-4_6 gpt-oss-120b kimi-k2 kimi-k2-thinking minimax-m2 qwen3-coder; do
            echo "Copying $folder/dist to dist/$folder"
            cp -rfv "$folder/dist" "dist/$folder"
          done
      
      - name: Create index.html
        run: |
          cat > dist/index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="en">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>Elevator Bench - Model Comparisons</title>
              <style>
                  body {
                      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
                      max-width: 1200px;
                      margin: 0 auto;
                      padding: 40px 20px;
                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                      min-height: 100vh;
                  }
                  .container {
                      background: white;
                      border-radius: 12px;
                      padding: 40px;
                      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
                  }
                  h1 {
                      color: #333;
                      margin-bottom: 10px;
                      font-size: 2.5em;
                  }
                  .subtitle {
                      color: #666;
                      margin-bottom: 40px;
                      font-size: 1.2em;
                  }
                  .models-grid {
                      display: grid;
                      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                      gap: 20px;
                      margin-top: 30px;
                  }
                  .model-card {
                      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
                      border-radius: 8px;
                      padding: 25px;
                      transition: transform 0.2s, box-shadow 0.2s;
                      text-decoration: none;
                      color: inherit;
                      display: block;
                  }
                  .model-card:hover {
                      transform: translateY(-5px);
                      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
                  }
                  .model-name {
                      font-size: 1.3em;
                      font-weight: 600;
                      color: #2c3e50;
                      margin-bottom: 10px;
                  }
                  .model-description {
                      color: #555;
                      font-size: 0.9em;
                  }
                  .arrow {
                      color: #667eea;
                      font-size: 1.2em;
                      float: right;
                  }
              </style>
          </head>
          <body>
              <div class="container">
                  <h1>üè¢ Elevator Bench</h1>
                  <p class="subtitle">Comparing elevator simulator implementations across different AI models</p>
                  
                  <div class="models-grid">
                      <a href="deepseek-v3_2/" class="model-card">
                          <div class="model-name">DeepSeek v3.2 <span class="arrow">‚Üí</span></div>
                          <div class="model-description">Elevator simulator implementation</div>
                      </a>
                      
                      <a href="github-copilot-gpt-5-codex/" class="model-card">
                          <div class="model-name">GitHub Copilot GPT-5 Codex <span class="arrow">‚Üí</span></div>
                          <div class="model-description">Elevator simulator implementation</div>
                      </a>
                      
                      <a href="github-copilot-sonnet-4_5/" class="model-card">
                          <div class="model-name">GitHub Copilot Sonnet 4.5 <span class="arrow">‚Üí</span></div>
                          <div class="model-description">Elevator simulator implementation</div>
                      </a>
                      
                      <a href="glm-4_6/" class="model-card">
                          <div class="model-name">GLM 4.6 <span class="arrow">‚Üí</span></div>
                          <div class="model-description">Elevator simulator implementation</div>
                      </a>
                      
                      <a href="gpt-oss-120b/" class="model-card">
                          <div class="model-name">GPT OSS 120B <span class="arrow">‚Üí</span></div>
                          <div class="model-description">Elevator simulator implementation</div>
                      </a>
                      
                      <a href="kimi-k2/" class="model-card">
                          <div class="model-name">Kimi K2 <span class="arrow">‚Üí</span></div>
                          <div class="model-description">Elevator simulator implementation</div>
                      </a>
                      
                      <a href="kimi-k2-thinking/" class="model-card">
                          <div class="model-name">Kimi K2 Thinking <span class="arrow">‚Üí</span></div>
                          <div class="model-description">Elevator simulator implementation</div>
                      </a>
                      
                      <a href="minimax-m2/" class="model-card">
                          <div class="model-name">MiniMax M2 <span class="arrow">‚Üí</span></div>
                          <div class="model-description">Elevator simulator implementation</div>
                      </a>
                      
                      <a href="qwen3-coder/" class="model-card">
                          <div class="model-name">Qwen3 Coder <span class="arrow">‚Üí</span></div>
                          <div class="model-description">Elevator simulator implementation</div>
                      </a>
                  </div>
              </div>
          </body>
          </html>
          EOF
      
      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./dist
          publish_branch: gh-pages
